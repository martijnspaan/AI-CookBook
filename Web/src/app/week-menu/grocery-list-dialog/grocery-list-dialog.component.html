<app-reusable-popup
  [isVisible]="isVisible"
  [config]="popupConfig"
  (popupClosed)="closeDialog()">
  
  <ng-template #popupBody>
    <!-- Grocery Day Selection -->
    <div class="mb-3">
      <label class="form-label fw-bold">{{ 'GROCERY_LISTS.CHOOSE_GROCERY_DAY' | translate }}</label>
      <select 
        class="form-select" 
        [(ngModel)]="selectedGroceryDay" 
        (change)="onGroceryDayChanged()">
        <option *ngFor="let option of groceryDayOptions" [ngValue]="option.date">
          {{ option.displayText }}
        </option>
      </select>
    </div>

    <!-- Meal Selection -->
    <div class="mb-2 flex-grow-1 d-flex flex-column">
      <div class="mb-2">
        <label class="form-label fw-bold">{{ 'GROCERY_LISTS.SELECT_MEALS_TO_INCLUDE' | translate }}</label>
        <div *ngIf="isLoadingGroceryLists" class="text-muted small">
          <i class="fas fa-spinner fa-spin me-1"></i>
          {{ 'GROCERY_LISTS.LOADING_EXISTING_LISTS' | translate }}
        </div>
      </div>
      
      <div class="meals-selection-compact">
        <div *ngFor="let dateGroup of mealsByDate" class="date-group-compact">
          <div class="date-header-compact">
            <h6 class="date-title-compact">{{ getDisplayDate(dateGroup.date) }}</h6>
          </div>
          
          <div class="meals-list-compact">
            <div *ngFor="let meal of dateGroup.meals" class="meal-item-compact" [class.meal-already-used]="meal.isAlreadyUsed">
              <div class="meal-checkbox-container">
                <input 
                  *ngIf="!meal.isAlreadyUsed"
                  class="meal-checkbox" 
                  type="checkbox" 
                  [id]="'meal-' + meal.date + '-' + meal.mealType"
                  [(ngModel)]="meal.isSelected"
                  (change)="onMealSelectionChanged(meal)">
                
                <div 
                  *ngIf="meal.isAlreadyUsed"
                  class="meal-disabled-icon"
                  [id]="'meal-' + meal.date + '-' + meal.mealType">
                  <i class="fas fa-shopping-cart"></i>
                </div>
              </div>
              
              <label 
                class="meal-label-compact" 
                [for]="'meal-' + meal.date + '-' + meal.mealType"
                [class.text-muted]="meal.isAlreadyUsed">
                <span class="meal-name-compact">{{ meal.recipeTitle }}</span>
                <span class="meal-badge-compact" [class.bg-primary]="!meal.isAlreadyUsed" [class.bg-secondary]="meal.isAlreadyUsed">
                  {{ getMealTypeLabel(meal.mealType) }}
                </span>
              </label>
            </div>
          </div>
        </div>
      </div>
      
      <div *ngIf="mealSelections.length === 0" class="empty-meals-state">
        <i class="fas fa-info-circle me-2"></i>
        {{ 'GROCERY_LISTS.NO_MEALS_SELECTED' | translate }}
      </div>
    </div>
  </ng-template>

  <ng-template #popupFooter>
    <div class="d-flex justify-content-end w-100">
      <button 
        type="button" 
        class="btn btn-success" 
        [disabled]="getSelectedMealsCount() === 0"
        (click)="createGroceryList()">
        <i class="fas fa-shopping-cart me-2"></i>
        {{ 'GROCERY_LISTS.CREATE_GROCERY_LIST' | translate }}
      </button>
    </div>
  </ng-template>
</app-reusable-popup>
